# UEF (User Eyes Focus)

Вспомогательная утилита, представленная в виде объявленных шагов для сокращения объема селекторов.

Пример:
```
пользователь фокусируется на "2" блок "главная кнопка"
```

Это означает, что все использующие UEF шаги теперь работают с элементами,
входящими во вторую кнопку, найденную по словарю selectors.
Этот элемент является блоком в "фокусе пользовательского зрения".
Тест как пользователь работает с ним и с его содержимым.
Далее возможна более глубокая навигация в пределах блока и анализ
каждого элемента этого блока,
не обращая внимание на содержимое вокруг блока.

Хороший пример пользы UEF - комплексные компоненты.
Например, блок Статус. Сфокусировались на нем и далее проверяем:
* заголовок
* описание
* наличие/отсутствие событий
(можно сфокусироваться на блок событий
и работать с элементами ссылок и кнопок внутри него)
* количество событий
* примечание
* стили блока
* иконку

В процессе данного теста нас не интересует
содержимое соседних блоков статусов,
мы можем полностью концетрироваться на нем
без уточняющих селекторов и без расширения словарей
ненужными значениями.

# Словари

Для поддержания семантики и BDD-принципов автотестирования
используются словари
(перевод текста в применимые для тестирования значения)
* attributes - маппинг на html-атрибуты (всплывающая подсказка -> title)
* css-properties - маппинг на css-свойство и доступные
для него значения (цвет фона - красный -> background-color: #CB1906)
* keyboard - маппинг на ключи клавиш webdriver.io (вверх -> ArrowUp)
* selectors - маппинг на селекторы webdriver.io,
рекомендуются к использованию селекторы
в комбинации с :hash-псевдоклассом,
разработанным специально для такого тестирования

# Пользовательские расширения

Элементы:
* объявление шагов,
* справочники,
* конфигурируемые объекты и функции
позволяют редактирование на стороне пользователя библиотеки.

Для расширения справочника необходимо осуществить, например:
```
const { dictionaries } = require('@sbol/brokkr')
Object.assign(dictionaries.cssProperties, myCssProperties)
```

Для расширения объявления шагов необходимо завести в проекте файл
`cucumber/index.js` и наполнить его
согласно API библиотеки `cucumber.js`.
Шаги можно создавать как перед/после выполнения сценариев,
так и с логикой по тэгам. Т.е. полный выбор деятельности.

Для расширения конфигурируемых объектов и функций
(функция логина, например) необходимо в пространстве
данной функции заменить конфигурационные функции на свои
```
const { config, getAuthUrl } = require('@sbol/brokkr')
Object.assign(config, { userKeyboardTimeout: 10 })
Object.assign(getAuthUrl.options, { getDevAuthUrl: () => '/set_client/first' })
```

# Доступные шаги

Ниже:
* в `"any"` указываются примеры переменных
* в `(?:any)` указываются опциональные словосочетания

## Абстракции

### Действия
* Семантические
    * пользователь нажимает клавишу "Enter"
    * пользователь ждет окончания загрузки
    * пользователь ждет появления блока "опция выпадающего меню"
    * пользователь ждет добавления блока "статус"
    * пользователь ждет исчезновения блока "опция выпадающего меню"
    * пользователь ждет удаления блока "статус"
    * пользователь нажимает (?:"2" )? "главную кнопку"
    * пользователь вводит в (?:"2" )?блок "многострочное поле ввода" значение "Я у мамы молодец"
    * пользователь удаляет значение в (?:"2" )?блок "многострочное поле ввода"
    * пользователь наводит курсор на (?:"2" )?"элемент со всплывающей подсказкой"
    * пользователь нажимает (?:"2" )?"главную кнопку" с текстом "та самая кнопка"
    * UEF
        * пользователь фокусируется на (?:"2" )?блок "главную кнопку"
        * пользователь фокусируется на (?:"2" )?блок "главную кнопку" с текстом "та самая кнопка"
    
* По тексту
    * пользователь кликает по кнопке с текстом "Та самая первая кнопка"
    * пользователь кликает по ссылке с текстом "Та самая первая ссылка"

* Работа с UEF
    * пользователь снова фокусируется на предыдущем блоке
    * пользователь фокусируется на браузере
    * пользователь зрительно фокусируется на браузере с клавиатурой
    * пользователь кликает по блоку в фокусе
    * пользователь наводит курсор на блок в фокусе
    
* Работа с окном
    * пользователь открывает сайт "https://www.sberbank.ru"
    * пользователь задает размер окна "800" на "600"
    * пользователь разворачивает окно
    * пользователь скролит вниз
    * пользователь скролит вниз в фокусе
    * пользователь обновляет страницу
    * пользователь возвращается на предыдущую страницу
    * пользователь закрывает вкладку
    * пользователь переключается на соседнюю вкладку справа
        * Обратите внимание, что во время клика на ссылку
        с target="_blank" в Chrome открывается новое окно и кажется,
        что мы уже переключили вкладку.
        Однако, хоть визуально мы и находимся на вновь открытой вкладке,
        фокус стоит на той, с которой мы уходили.
        Соответсветнно, прежде чем вы начнете работать
        с новой вкладкой - перейдите на нее.
    * пользователь переключается на соседнюю вкладку слева

* Остановка исполнения автотеста для перехвата
управления разработчиком (использовать с окружением DEBUG)
    * дебаг

### Проверки
* Базовые
    * открыт адрес сайта "https://www.sberbank.ru"
    * пользователь проверяет заголовок документа "Заявка на кредит"
    * пользователь проверяет заголовок страницы "Сбербанк Онлайн"
    * присутствует (?:элемент|кнопка|поле) с текстом "У меня есть текст"
    * (?:отсутствует|не отображается) (?:элемент|кнопка|поле) с текстом "У меня есть текст, но меня нет"
    * в консоли отсутствует сообщения "Отлаживаемся"
    * в консоли появилось сообщение "Отлаживаемся"

* Семантические
    * присутствует блок "статус заявки"
    * блок "чекбокс" выбран
    * блок "чекбокс" не выбран
    * блок "многострочное поле ввода" доступен для ввода
    * блок "поле ввода" заблокирован
    * блок "поле ввода" не в фокусе ввода
    * блок "поле ввода" в фокусе ввода
    * присутствует "5" блок(?:а|ов)? "поле ввода"
    * (?:отсутствует|не отображается) блок "поле ввода"
    * у (?:"2" )?блока "поле ввода" атрибут "подсказка поля ввода" равен "0"
    * у (?:"2" )?блока "статус отклонено" свойство "цвет фона" равно "красный"
    * у блока в фокусе атрибут "подсказка поля ввода" равен "0"
    * у блока в фокусе свойство "цвет фона" равно "красный"
    * пользователь проверяет текст блока в фокусе равный "Данный блок в UEF"

## Бизнес логика (зависит от среды запуска = dev, ift_sigma, ift_alpha)

### login
* пользователь авторизуется в СБОЛ по id "second"

### logout
* Пользователь выходит из системы

### navigation
* пользователь переходит в проект с id "cards.debit"
* пользователь переходит в проект с id "cards.debit", дополняя ссылку "#/request?documentId=1234"