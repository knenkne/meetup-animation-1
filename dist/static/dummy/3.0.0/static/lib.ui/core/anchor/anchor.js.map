{"version":3,"file":"anchor.js","sources":["../../src/anchor/anchor.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef, useMemo } from 'react'\nimport PropTypes from 'prop-types'\nimport { noop, uniqueId, throttle } from 'lodash'\n\nimport { Header } from '../tabs/header'\nimport { getFirstChildTitle, getTopOffset, useUpdateEffect, scrollToElement } from '../tabs/tab-utils'\nimport { Tabs } from '../tabs'\n\nimport { Link } from './link'\nimport style from './anchor.css'\n\nconst THROTTLE_DELAY = 300\n\nconst parentId = uniqueId('anchor-link-wrapper-')\n\n/**\n * [Zeplin](https://app.zeplin.io/project/59312e1ebdf1da6fc8d37ffb/dashboard?q=Blocks%20Tabs)\n * Компонент прокрутки блоков верстки\n *\n * @param {Object} props - свойства компонента\n * @return {JSX} - компонент\n */\nexport const Anchor = ({ children, colorScheme, size, initialValue, mode, onChange, onClick, theme }) => {\n\n    const [selectedTitle, setSelectedTitle] = useState(() => initialValue || getFirstChildTitle(children))\n    const childrenArray = useMemo(() => React.Children.toArray(children), [children])\n    const topOffset = useMemo(() => getTopOffset(mode), [mode])\n\n    useUpdateEffect(() => {\n        onChange(selectedTitle)\n    }, [selectedTitle])\n\n    const scrolling = useRef(false)\n\n    const references = useRef({})\n\n    const handleScroll = () => {\n        if (scrolling.current) {\n            return\n        }\n        const referencesKeys = Object.keys(references.current)\n\n        const selectedTitleKey = referencesKeys.find((key) => {\n            const rect = references.current[key].getBoundingClientRect()\n\n            return Math.round(rect.bottom) - topOffset > 0\n        })\n\n        if (selectedTitleKey) {\n            setSelectedTitle(selectedTitleKey)\n            return\n        }\n\n        const lastRef = referencesKeys[referencesKeys.length - 1]\n\n        if (references.current[lastRef].getBoundingClientRect().top < 0) {\n            setSelectedTitle(lastRef)\n        }\n    }\n\n    const throttleScroll = throttle(handleScroll, THROTTLE_DELAY)\n\n    const getSelectedChild = () => childrenArray.map((child, i) => {\n        const setRef = (ref) => {\n            if (child.props.title) {\n                references.current[child.props.title] = ref\n            }\n        }\n        const key = `${child.props.title}-${i}`\n\n        return (\n            <div id={`anchor-link-id-${i}`} ref={setRef} key={key} tabIndex=\"-1\" className={style.outlineNone}>\n                {child.props.children}\n            </div>\n        )\n    })\n\n    const handleChange = (value) => {\n        const ref = references.current[value]\n        onClick(value)\n\n        if (ref) {\n            scrolling.current = true\n            scrollToElement(ref, { offset: topOffset }, () => {\n                scrolling.current = false\n                ref.focus({ preventScroll: true })\n                setSelectedTitle(value)\n            })\n        }\n    }\n\n    const mapChildren = () =>\n        childrenArray.map((child) =>\n            React.cloneElement(child, {\n                colorScheme,\n                forceOpened: child.props.forceOpened || selectedTitle === child.props.title,\n                onChange: handleChange,\n                parentId,\n                size,\n            })\n        )\n\n\n    const containerRef = useRef()\n\n    const isInViewPort = () => {\n        if (containerRef) {\n            const rect = containerRef.current.getBoundingClientRect()\n            if ((rect.top < 0 && rect.bottom < 0) ||\n                (rect.top > window.innerHeight && rect.bottom > window.innerHeight)) {\n                window.removeEventListener('scroll', throttleScroll)\n                return\n            }\n            window.addEventListener('scroll', throttleScroll)\n        }\n    }\n\n    const throttleViewPort = throttle(isInViewPort, THROTTLE_DELAY)\n\n    useEffect(() => {\n        window.addEventListener('scroll', throttleViewPort)\n        return () => {\n            window.removeEventListener('scroll', throttleViewPort)\n            window.removeEventListener('scroll', throttleScroll)\n        }\n    }, [])\n\n    if (!children) {\n        return null\n    }\n\n    return (\n        <div ref={containerRef} className={theme.tabs}>\n            <Header parentId={parentId} mode={mode} theme={theme}>\n                <div className={theme.tabsNavigation}>\n                    {mapChildren()}\n                </div>\n            </Header>\n            <section className={theme.tabsContent} >\n                {getSelectedChild()}\n            </section>\n        </div>\n    )\n}\n\nAnchor.propTypes = {\n    onChange: PropTypes.func,\n    onClick: PropTypes.func,\n    /**\n     * Общая цветовая схема\n     */\n    colorScheme: PropTypes.oneOf([\n        'base',\n        'purple',\n        'blue',\n        'green',\n        'black',\n        'skyblue',\n        'aqua',\n        'gold'\n    ]),\n    initialValue: PropTypes.string,\n    children: PropTypes.node,\n    size: PropTypes.oneOf(['sm', 'lg']),\n    /**\n     * Задает варианты отображения перечня заголовков\n     * fullwidth - отображение длинной линии по всей ширине контентой части для продуктовой страницы\n     * sticky - прилипание шапки к родительскому компоненту\n     */\n    mode: PropTypes.oneOfType([\n        PropTypes.oneOf(['sticky', 'fullwidth']),\n        PropTypes.arrayOf(PropTypes.oneOf(['sticky', 'fullwidth']))\n    ]),\n    theme: PropTypes.object\n}\n\nAnchor.defaultProps = {\n    onChange: noop,\n    onClick: noop,\n    colorScheme: 'base',\n    initialValue: void 0,\n    children: void 0,\n    size: 'lg',\n    mode: void 0,\n    theme: Tabs.theme\n}\n\nAnchor.Link = Link\nAnchor.displayName = 'Anchor'\n"],"names":["THROTTLE_DELAY","parentId","uniqueId","Anchor","children","colorScheme","size","initialValue","mode","onChange","onClick","theme","useState","getFirstChildTitle","selectedTitle","setSelectedTitle","childrenArray","useMemo","React","Children","toArray","topOffset","getTopOffset","useUpdateEffect","scrolling","useRef","references","handleScroll","current","referencesKeys","Object","keys","selectedTitleKey","find","key","rect","getBoundingClientRect","Math","round","bottom","lastRef","length","top","throttleScroll","throttle","getSelectedChild","map","child","i","setRef","ref","props","title","style","outlineNone","handleChange","value","scrollToElement","offset","focus","preventScroll","mapChildren","cloneElement","forceOpened","containerRef","isInViewPort","window","innerHeight","removeEventListener","addEventListener","throttleViewPort","useEffect","tabs","tabsNavigation","tabsContent","propTypes","PropTypes","func","oneOf","string","node","oneOfType","arrayOf","object","defaultProps","noop","Tabs","Link","displayName"],"mappings":"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"}