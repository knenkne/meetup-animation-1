{"version":3,"file":"calendar-item.js","sources":["../../../../src/calendar/components/calendar-item/calendar-item.jsx"],"sourcesContent":["import React, { useEffect, useState } from 'react'\nimport PropTypes from 'prop-types'\nimport _ from 'lodash'\nimport cn from 'classnames'\nimport toDate from 'date-fns/toDate'\nimport isValid from 'date-fns/isValid'\n\nimport { CALENDAR_MODES } from '../../constants'\nimport { chooseValidDate } from '../../utils'\nimport { Controls } from '../controls'\nimport { CalendarContext } from '../../context'\nimport style from '../../style.css'\n\nimport { ShowTable } from './show-table'\n\nexport const CalendarItem = (props) => {\n    const { mode, restriction, value, to, initialValue, startingYear, onChange, isOpened } = props\n\n    const initialDate = chooseValidDate(to, value)\n\n    const [currentDate, setCurrentDate] = useState(initialDate)\n    const [showDate, setShowDate] = useState(initialDate)\n    const [showComponent, setShowComponent] = useState(mode || CALENDAR_MODES.DEFAULT)\n\n    const setMode = (currentComponent) => setShowComponent(showComponent !== currentComponent ? currentComponent : mode)\n    const handleClick = (date, e) => {\n        if (toDate(date) !== toDate(currentDate)) {\n            setShowDate(toDate(date))\n            setCurrentDate(date)\n            return showComponent === mode ? onChange(date, e) : setMode(mode)\n        }\n\n        return void 0\n    }\n\n    const state = {\n        currentDate,\n        showComponent,\n        showDate,\n        handleClick,\n        setMode,\n        startingYear,\n        initialValue,\n        restriction,\n        mode,\n    }\n\n    useEffect(() => {\n        if (isValid(to)) {\n            setShowDate(toDate(to))\n            setCurrentDate(to)\n        } else if (isValid(value)) {\n            setShowDate(toDate(value))\n            setCurrentDate(toDate(value))\n        }\n    }, [value, to])\n\n    useEffect(() => {\n        if (!isOpened) {\n            setShowDate(initialDate)\n            setCurrentDate(initialDate)\n        }\n    }, [isOpened])\n\n    return (\n        <CalendarContext.Provider value={state}>\n            <div\n                className={cn(\n                    style.datePicker,\n                    mode === CALENDAR_MODES.YEARS && style.datePickerYears,\n                    showComponent !== CALENDAR_MODES.DEFAULT && style.yearsOrMonths\n                )}\n                data-node=\"calendar:item\"\n                aria-hidden=\"true\"\n            >\n                {mode !== CALENDAR_MODES.YEARS && (\n                    <Controls />\n                )}\n                <ShowTable showComponent={showComponent} />\n            </div>\n        </CalendarContext.Provider>\n    )\n}\n\nCalendarItem.propTypes = {\n    /**\n     * Полная ISO строка даты или дапазон ISO дат, разделенных \"/\"\n     */\n    value: PropTypes.string,\n    /**\n     * Полная ISO строка даты\n     */\n    initialValue: PropTypes.string,\n    /**\n     * Год, с которого начинается таблица выбора годов. ISO строка года\n     */\n    startingYear: PropTypes.string,\n    /**\n     *  Режимы отображения одного календаря:<br>\n     * <b>'default'</b> - выбор дня, месяца и года<br>\n     * <b>'years'</b> - выбор года<br>\n     * <b>'months'</b> - выбор месяца и года<br>\n     * <b>'quarters'</b> - выбор квартала и года\n     */\n    mode: PropTypes.oneOf([\n        'default',\n        'years',\n        'months',\n        'quarters'\n    ]),\n    /**\n     * Функция, запрещающая выбор даты. Принимает в качестве аргумента дату в формате объекта Date, возвращает логическое значение\n     * (instanceof(Date)) => boolean\n     */\n    restriction: PropTypes.func,\n    /**\n     * Полная ISO строка даты\n     */\n    to: PropTypes.string,\n    onChange: PropTypes.func,\n    /**\n     * Показывает активен ли календарь, если он привязан к какому-либо компоненту\n     */\n    isOpened: PropTypes.bool\n}\n\nCalendarItem.defaultProps = {\n    value: '',\n    initialValue: '',\n    startingYear: void 0,\n    mode: 'default',\n    restriction: _.stubTrue,\n    to: '',\n    onChange: _.noop,\n    isOpened: _.false,\n    translations: void 0\n}\n"],"names":["CalendarItem","props","mode","restriction","value","to","initialValue","startingYear","onChange","isOpened","initialDate","chooseValidDate","useState","currentDate","setCurrentDate","showDate","setShowDate","CALENDAR_MODES","DEFAULT","showComponent","setShowComponent","setMode","currentComponent","handleClick","date","e","toDate","state","useEffect","isValid","cn","style","datePicker","YEARS","datePickerYears","yearsOrMonths","propTypes","PropTypes","string","oneOf","func","bool","defaultProps","_","stubTrue","noop","false","translations"],"mappings":"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"}