{"version":3,"file":"icon.js","sources":["../../src/icon/icon.jsx"],"sourcesContent":["import React from 'react'\nimport PropTypes from 'prop-types'\nimport _ from 'lodash'\nimport cs from 'classnames'\n\nimport defaultTheme from './style.css'\n\nconst SLASH = '/'\nconst iconOmit = ['name', 'theme', 'mode', 'size']\n\n/* eslint-disable valid-jsdoc, comment: некорректный парсинг jsdoc */\n/**\n * [Zeplin](https://app.zeplin.io/project/59312e1ebdf1da6fc8d37ffb/dashboard?q=elements%20icons)\n * Компонент для вывода svg-иконок\n *\n * @param {Object} props - свойства компонента\n * @return {JSX} - компонент\n */\nexport class Icon extends React.PureComponent {\n    static addIcons = (namespace, promise) => {\n        if (Icon.namespaces[namespace]) {\n            return\n        }\n\n        if (typeof promise === 'function') {\n            Icon.namespaces[namespace] = () => promise()\n                .then(({ default: defaultExport = {}, ...namedExport } = {}) => {\n                    const icons = { ...namedExport, ...defaultExport }\n\n                    Icon.namespaces[namespace] = _.mapKeys(icons, (value, key) => _.camelCase(key))\n\n                    return icons\n                })\n        } else {\n            Icon.namespaces[namespace] = _.mapKeys(promise, (value, key) => _.camelCase(key))\n        }\n    }\n\n    static displayName = 'Icon'\n\n    static propTypes = {\n        name: PropTypes.string.isRequired,\n        theme: PropTypes.shape({\n            icon: PropTypes.string\n        }),\n        size: PropTypes.oneOf(['xs', 'sm', 'md', 'lg', 'xl', 'self']),\n        onError: PropTypes.func,\n        onClick: PropTypes.func\n    }\n\n    static defaultProps = {\n        theme: defaultTheme,\n        size: void 0,\n        onError: _.noop,\n        onClick: _.noop\n    }\n\n    /**\n     * Метод для фиксирования префикса (process.env.PKG_ID) для генерации уникальных id в svg иконках\n     * @param projectId\n     */\n    static setProject = (projectId) => {\n        Icon.iconProjectId = projectId\n    }\n\n    componentDidMount () {\n        this.loadIcons(this.props)\n    }\n\n    // eslint-disable-next-line babel/camelcase, comment: React UNSAFE method\n    UNSAFE_componentWillReceiveProps (nextProps) {\n        this.loadIcons(nextProps)\n    }\n\n    componentWillUnmount () {\n        this.unmount = true\n    }\n\n    getName = (fullPath) => _.camelCase(_.last(fullPath.split(SLASH)))\n    getNamespace = (fullPath) => _.dropRight(fullPath.split(SLASH)).join(SLASH)\n\n    static namespaces = {}\n    static theme = defaultTheme\n    static iconProjectId = ''\n    static loadedList = {}\n\n    loadIcons = (props) => {\n        const namespace = this.getNamespace(props.name)\n        const { onError } = this.props\n\n        if (namespace && _.isFunction(Icon.namespaces[namespace])) {\n            Icon.namespaces[namespace]()\n                .then(() => {\n                    if (!this.unmount) {\n                        Icon.loadedList[namespace] = true\n                        this.forceUpdate()\n                    }\n                }).catch(onError)\n        }\n    }\n\n    addUniqueId = (icon, namespace, name) => {\n        let formattedIcon = icon\n        const newIdBase = `${Icon.iconProjectId}::${namespace}/${name}::`\n        const refIds = icon?.match(/(id=\"([^\\s\"])+\")/g)\n        if (refIds) {\n            refIds.forEach((refId) => {\n                const refIdForm = refId.substring(4, refId.length - 1)\n                const newId = newIdBase + _.uniqueId()\n                formattedIcon = _.replace(formattedIcon, new RegExp(`#${refIdForm}`, 'g'), `#${newId}`)\n                formattedIcon = _.replace(formattedIcon, new RegExp(`id=\"${refIdForm}\"`, 'g'), `id=\"${newId}\"`)\n            })\n        }\n\n        return formattedIcon\n    }\n\n    render () {\n        const { name: fullPath, theme, size, onError } = this.props\n\n        const namespace = this.getNamespace(fullPath)\n        const name = this.getName(fullPath)\n\n        if (!_.has(Icon.namespaces, [namespace, name])) {\n            if (!Icon.namespaces[namespace] || Icon.loadedList[namespace]) {\n                onError()\n            }\n\n            return null\n        }\n        const icon = _.get(Icon.namespaces, [namespace, name])\n        const formattedIcon = this.addUniqueId(icon, namespace, name)\n\n        const passedProps = _(this.props)\n            .omit(iconOmit)\n            .extend({\n                'data-unit': 'icon',\n                className: cs(size === 'self' ? theme[size] : cs(theme.icon, theme[size])),\n                dangerouslySetInnerHTML: {\n                    __html: formattedIcon\n                }\n            })\n            .value()\n\n        return <span {...passedProps} />\n    }\n}\n\nexport default Icon\n"],"names":["SLASH","iconOmit","Icon","fullPath","_","camelCase","last","split","dropRight","join","props","namespace","getNamespace","name","onError","isFunction","namespaces","then","unmount","loadedList","forceUpdate","catch","icon","formattedIcon","newIdBase","iconProjectId","refIds","match","forEach","refId","refIdForm","substring","length","newId","uniqueId","replace","RegExp","loadIcons","nextProps","theme","size","getName","has","get","addUniqueId","passedProps","omit","extend","className","cs","dangerouslySetInnerHTML","__html","value","React","PureComponent","promise","default","defaultExport","namedExport","icons","mapKeys","key","PropTypes","string","isRequired","shape","oneOf","func","onClick","defaultTheme","noop","projectId"],"mappings":"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"}