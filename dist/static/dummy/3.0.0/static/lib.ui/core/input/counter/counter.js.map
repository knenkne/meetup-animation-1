{"version":3,"file":"counter.js","sources":["../../../src/input/counter/counter.jsx"],"sourcesContent":["import React from 'react'\nimport PropTypes from 'prop-types'\nimport _ from 'lodash'\nimport classnames from 'classnames'\n\nimport { autoSizeFactory } from '../hoc/auto-size'\nimport { Numeric } from '../numeric/numeric'\nimport defaultInputTheme from '../input.css'\n\nimport { CounterControl } from './counter-control'\nimport defaultTheme from './counter.css'\n\nconst TOP_ARROW = 38\nconst BOTTOM_ARROW = 40\nconst HOME = 36\nconst END = 35\nconst PAGE_UP = 33\nconst PAGE_DOWN = 34\n\nconst MULTIPLICITY = 10\n\nconst AdaptiveNumeric = autoSizeFactory({ minWidth: 36 })(Numeric)\n\nconst inputTheme = _.extend({}, defaultInputTheme, {\n    input: classnames(defaultInputTheme.input, defaultTheme.input)\n})\n\n/* eslint-disable valid-jsdoc, comment: некорректный парсинг jsdoc */\n/**\n * [Zeplin](https://app.zeplin.io/project/5c74ef0d753f3ebccdf8f33d/screen/5cadc53a40aa3004f12e5f7e)\n * Аналог input type=\"number\" с role=\"spinbutton\"\n *\n * @param {Object} props - свойства компонента\n * @return {JSX} - компонент\n */\nexport class Counter extends React.PureComponent {\n    static propTypes = {\n        value: PropTypes.string.isRequired,\n        onKeyDown: PropTypes.func,\n        onChange: PropTypes.func,\n        disabled: PropTypes.bool,\n        min: PropTypes.number,\n        max: PropTypes.number,\n        step: PropTypes.number,\n        translations: PropTypes.shape({\n            minWarning: PropTypes.string,\n            maxWarning: PropTypes.string\n        }),\n        prefix: PropTypes.string,\n        suffix: PropTypes.string,\n        /**\n         * use this for a11y naming\n         */\n        title: PropTypes.string.isRequired,\n        colorScheme: PropTypes.oneOf([\n            'green',\n            'blue',\n            'violet',\n            'turquoise',\n            'sky-blue',\n            'aqua',\n            'gold',\n            'charcoal-grey'\n        ]),\n        readonly: PropTypes.bool,\n        readOnly: PropTypes.bool,\n        mode: PropTypes.oneOf(['wide', void 0])\n    }\n\n    static defaultProps = {\n        onChange: _.noop,\n        onKeyDown: _.noop,\n        min: 0,\n        max: Infinity,\n        translations: {\n            minWarning: void 0,\n            maxWarning: void 0\n        },\n        step: 1,\n        disabled: false,\n\n        prefix: '',\n        suffix: '',\n        colorScheme: 'green',\n        readonly: false,\n        readOnly: false,\n        mode: void 0\n    }\n\n    getWarning = () => {\n        const {\n            min,\n            max,\n            translations: { minWarning, maxWarning },\n            value\n        } = this.props\n\n        if (value < min) {\n            return minWarning\n        } else if (value > max) {\n            return maxWarning\n        }\n\n        return null\n    }\n\n    handleDecrease = () => {\n        this.handleDecreaseByTimes(1)\n    }\n\n    handleIncrease = () => {\n        this.handleIncreaseByTimes(1)\n    }\n\n    handleDecreaseByTimes = (times) => {\n        const { step, value, onChange, min, max } = this.props\n        const newValue = _.toString(\n            _.clamp(_.toInteger(value) - (times * step), min, max)\n        )\n\n        if (newValue !== value) {\n            onChange(newValue)\n        }\n    }\n\n    handleIncreaseByTimes = (times) => {\n        const { step, value, onChange, min, max } = this.props\n        const newValue = _.toString(\n            _.clamp(_.toInteger(value) + (times * step), min, max)\n        )\n\n        if (newValue !== value) {\n            onChange(newValue)\n        }\n    }\n\n    handleKeyDown = (event) => {\n        const { onChange, min, max, onKeyDown, disabled } = this.props\n\n        /*\n         * Важно понимать что выражение `event.preventDefault()` необходимо выполнять после изменения значения.\n         * Такая необходимость происходит из-за того, что некоторые скринридеры (VoiceOver) меняют режим взаимодействия браузера и клавиатуры,\n         * что, в свою очередь, отменяет возможность клавиатурным событиям менять значение и ломать a11y.\n         * */\n        if (!disabled) {\n            switch (event.keyCode) {\n                case BOTTOM_ARROW: {\n                    this.handleDecreaseByTimes(1)\n                    event.preventDefault()\n                    break\n                }\n                case TOP_ARROW: {\n                    this.handleIncreaseByTimes(1)\n                    event.preventDefault()\n                    break\n                }\n                case HOME: {\n                    onChange(_.toString(min))\n                    event.preventDefault()\n                    break\n                }\n                case END: {\n                    onChange(_.toString(max))\n                    event.preventDefault()\n                    break\n                }\n                case PAGE_DOWN: {\n                    this.handleDecreaseByTimes(MULTIPLICITY)\n                    event.preventDefault()\n                    break\n                }\n                case PAGE_UP: {\n                    this.handleIncreaseByTimes(MULTIPLICITY)\n                    event.preventDefault()\n                    break\n                }\n\n                default: {\n                    break\n                }\n            }\n        }\n\n        onKeyDown(event)\n    }\n\n    render () {\n        const {\n            min,\n            max,\n            step,\n            disabled,\n            value,\n            prefix,\n            suffix,\n            title,\n            colorScheme,\n            readonly,\n            readOnly,\n            mode\n        } = this.props\n\n        const inputProps = _(this.props)\n            .omit(['translations', 'step', 'colorScheme', 'mode'])\n            .extend({\n                theme: inputTheme,\n                onKeyDown: this.handleKeyDown,\n                autoComplete: 'off',\n                allowDecimal: false,\n                allowEmpty: false,\n                role: 'spinbutton',\n                'aria-disabled': disabled,\n                'aria-valuenow': value,\n                'aria-valuemin': min,\n                'aria-valuemax': max,\n                'aria-valuetext': `${prefix}${value}${suffix}`,\n                'aria-label': title\n            })\n            .value()\n\n        const parsedValue = _.toInteger(value)\n        const canDecrease = parsedValue - step < min\n        const canIncrease = parsedValue + step > max\n\n        const InputComponent = mode === 'wide' ? Numeric : AdaptiveNumeric\n\n        return (\n            <div\n                className={classnames(\n                    defaultTheme.counter,\n                    defaultTheme[colorScheme],\n                    mode === 'wide' && defaultTheme.wide\n                )}\n                data-unit=\"input:counter\"\n            >\n                <InputComponent {...inputProps} />\n\n                {!readonly && !readOnly && !disabled && (\n                    <>\n                        <CounterControl\n                            mode=\"decrease\"\n                            onClick={this.handleDecrease}\n                            disabled={canDecrease}\n                            aria-hidden=\"true\"\n                        />\n\n                        <CounterControl\n                            mode=\"increase\"\n                            onClick={this.handleIncrease}\n                            disabled={canIncrease}\n                            aria-hidden=\"true\"\n                        />\n                    </>\n                )}\n            </div>\n        )\n    }\n}\n\nCounter.theme = defaultTheme\nCounter.displayName = 'Input.Counter'\n"],"names":["TOP_ARROW","BOTTOM_ARROW","HOME","END","PAGE_UP","PAGE_DOWN","MULTIPLICITY","AdaptiveNumeric","autoSizeFactory","minWidth","Numeric","inputTheme","_","extend","defaultInputTheme","input","classnames","defaultTheme","Counter","props","min","max","translations","minWarning","maxWarning","value","handleDecreaseByTimes","handleIncreaseByTimes","times","step","onChange","newValue","toString","clamp","toInteger","event","onKeyDown","disabled","keyCode","preventDefault","prefix","suffix","title","colorScheme","readonly","readOnly","mode","inputProps","omit","theme","handleKeyDown","autoComplete","allowDecimal","allowEmpty","role","parsedValue","canDecrease","canIncrease","InputComponent","counter","wide","handleDecrease","handleIncrease","React","PureComponent","PropTypes","string","isRequired","func","bool","number","shape","oneOf","noop","Infinity","displayName"],"mappings":"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"}