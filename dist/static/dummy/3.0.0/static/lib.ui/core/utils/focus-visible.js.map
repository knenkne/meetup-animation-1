{"version":3,"file":"focus-visible.js","sources":["../../src/utils/focus-visible.js"],"sourcesContent":["/* eslint-disable */\n/* modification of original focus-visible polyfill */\n(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? factory() :\n        typeof define === 'function' && define.amd ? define(factory) :\n            (factory());\n}(this, (function () { 'use strict';\n\n    /**\n     * https://github.com/WICG/focus-visible\n     */\n    function init() {\n        var hadKeyboardEvent = true;\n        var hadFocusVisibleRecently = false;\n        var hadFocusVisibleRecentlyTimeout = null;\n\n        var inputTypesWhitelist = {\n            text: true,\n            search: true,\n            url: true,\n            tel: true,\n            email: true,\n            password: true,\n            number: true,\n            date: true,\n            month: true,\n            week: true,\n            time: true,\n            datetime: true,\n            'datetime-local': true\n        };\n\n        /**\n         * Helper function for legacy browsers and iframes which sometimes focus\n         * elements like document, body, and non-interactive SVG.\n         * @param {Element} el\n         */\n        function isValidFocusTarget(el) {\n            if (\n                el &&\n                el !== document &&\n                el.nodeName !== 'HTML' &&\n                el.nodeName !== 'BODY' &&\n                'classList' in el &&\n                'contains' in el.classList\n            ) {\n                return true;\n            }\n            return false;\n        }\n\n        /**\n         * Computes whether the given element should automatically trigger the\n         * `focus-visible` class being added, i.e. whether it should always match\n         * `:focus-visible` when focused.\n         * @param {Element} el\n         * @return {boolean}\n         */\n        function focusTriggersKeyboardModality(el) {\n            var type = el.type;\n            var tagName = el.tagName;\n\n            if (tagName == 'INPUT' && inputTypesWhitelist[type] && !el.readOnly) {\n                return true;\n            }\n\n            if (tagName == 'TEXTAREA' && !el.readOnly) {\n                return true;\n            }\n\n            if (el.isContentEditable) {\n                return true;\n            }\n\n            return false;\n        }\n\n        function removePointerEventsClass() {\n            if (!document.body.classList.contains('pointer-events')) {\n                return;\n            }\n            document.body.classList.remove('pointer-events');\n        }\n\n        function addPointerEventsClass() {\n            document.body.classList.add('pointer-events');\n        }\n\n        /**\n         * Treat `keydown` as a signal that the user is in keyboard modality.\n         * Apply `focus-visible` to any current active element and keep track\n         * of our keyboard modality state with `hadKeyboardEvent`.\n         * @param {Event} e\n         */\n        function onKeyDown(e) {\n            if (isValidFocusTarget(document.activeElement)) {\n                removePointerEventsClass();\n            }\n\n            hadKeyboardEvent = true;\n        }\n\n        /**\n         * If at any point a user clicks with a pointing device, ensure that we change\n         * the modality away from keyboard.\n         * This avoids the situation where a user presses a key on an already focused\n         * element, and then clicks on a different element, focusing it with a\n         * pointing device, while we still think we're in keyboard modality.\n         * @param {Event} e\n         */\n        function onPointerDown(e) {\n            hadKeyboardEvent = false;\n        }\n\n        /**\n         * On `focus`, add the `focus-visible` class to the target if:\n         * - the target received focus as a result of keyboard navigation, or\n         * - the event target is an element that will likely require interaction\n         *   via the keyboard (e.g. a text box)\n         * @param {Event} e\n         */\n        function onFocus(e) {\n            // Prevent IE from focusing the document or HTML element.\n            if (!isValidFocusTarget(e.target)) {\n                return;\n            }\n\n            if (hadKeyboardEvent || focusTriggersKeyboardModality(e.target)) {\n                removePointerEventsClass();\n            }\n        }\n\n        /**\n         * On `blur`, remove the `focus-visible` class from the target.\n         * @param {Event} e\n         */\n        function onBlur(e) {\n            if (!isValidFocusTarget(e.target)) {\n                return;\n            }\n\n            if (\n                !document.body.classList.contains('pointer-events')\n            ) {\n                // To detect a tab/window switch, we look for a blur event followed\n                // rapidly by a visibility change.\n                // If we don't see a visibility change within 100ms, it's probably a\n                // regular focus change.\n                hadFocusVisibleRecently = true;\n                window.clearTimeout(hadFocusVisibleRecentlyTimeout);\n                hadFocusVisibleRecentlyTimeout = window.setTimeout(function() {\n                    hadFocusVisibleRecently = false;\n                    window.clearTimeout(hadFocusVisibleRecentlyTimeout);\n                }, 100);\n                if (!hadKeyboardEvent) {\n                    addPointerEventsClass(e.target);\n                }\n            }\n        }\n\n        /**\n         * If the user changes tabs, keep track of whether or not the previously\n         * focused element had .focus-visible.\n         * @param {Event} e\n         */\n        function onVisibilityChange(e) {\n            if (document.visibilityState == 'hidden') {\n                // If the tab becomes active again, the browser will handle calling focus\n                // on the element (Safari actually calls it twice).\n                // If this tab change caused a blur on an element with focus-visible,\n                // re-apply the class when the user switches back to the tab.\n                if (hadFocusVisibleRecently) {\n                    hadKeyboardEvent = true;\n                }\n                addInitialPointerMoveListeners();\n            }\n        }\n\n        /**\n         * Add a group of listeners to detect usage of any pointing devices.\n         * These listeners will be added when the polyfill first loads, and anytime\n         * the window is blurred, so that they are active when the window regains\n         * focus.\n         */\n        function addInitialPointerMoveListeners() {\n            document.addEventListener('mousemove', onInitialPointerMove);\n            document.addEventListener('mousedown', onInitialPointerMove);\n            document.addEventListener('mouseup', onInitialPointerMove);\n            document.addEventListener('pointermove', onInitialPointerMove);\n            document.addEventListener('pointerdown', onInitialPointerMove);\n            document.addEventListener('pointerup', onInitialPointerMove);\n            document.addEventListener('touchmove', onInitialPointerMove);\n            document.addEventListener('touchstart', onInitialPointerMove);\n            document.addEventListener('touchend', onInitialPointerMove);\n        }\n\n        function removeInitialPointerMoveListeners() {\n            document.removeEventListener('mousemove', onInitialPointerMove);\n            document.removeEventListener('mousedown', onInitialPointerMove);\n            document.removeEventListener('mouseup', onInitialPointerMove);\n            document.removeEventListener('pointermove', onInitialPointerMove);\n            document.removeEventListener('pointerdown', onInitialPointerMove);\n            document.removeEventListener('pointerup', onInitialPointerMove);\n            document.removeEventListener('touchmove', onInitialPointerMove);\n            document.removeEventListener('touchstart', onInitialPointerMove);\n            document.removeEventListener('touchend', onInitialPointerMove);\n        }\n\n        /**\n         * When the polfyill first loads, assume the user is in keyboard modality.\n         * If any event is received from a pointing device (e.g. mouse, pointer,\n         * touch), turn off keyboard modality.\n         * This accounts for situations where focus enters the page from the URL bar.\n         * @param {Event} e\n         */\n        function onInitialPointerMove(e) {\n            // Work around a Safari quirk that fires a mousemove on <html> whenever the\n            // window blurs, even if you're tabbing out of the page. ¯\\_(ツ)_/¯\n            if (e.target.nodeName.toLowerCase() === 'html') {\n                return;\n            }\n\n            hadKeyboardEvent = false;\n            removeInitialPointerMoveListeners();\n        }\n\n        document.addEventListener('keydown', onKeyDown, true);\n        document.addEventListener('mousedown', onPointerDown, true);\n        document.addEventListener('pointerdown', onPointerDown, true);\n        document.addEventListener('touchstart', onPointerDown, true);\n        document.addEventListener('focus', onFocus, true);\n        document.addEventListener('blur', onBlur, true);\n        document.addEventListener('visibilitychange', onVisibilityChange, true);\n        addInitialPointerMoveListeners();\n        addPointerEventsClass();\n    }\n\n    /**\n     * Subscription when the DOM is ready\n     * @param {Function} callback\n     */\n    function onDOMReady(callback) {\n        var loaded;\n\n        /**\n         * Callback wrapper for check loaded state\n         */\n        function load() {\n            if (!loaded) {\n                loaded = true;\n                callback();\n            }\n        }\n\n        if (['interactive', 'complete'].indexOf(document.readyState) >= 0) {\n            loaded = true;\n            callback();\n        } else {\n            loaded = false;\n            document.addEventListener('DOMContentLoaded', load, false);\n            window.addEventListener('load', load, false);\n        }\n    }\n\n    if (typeof document !== 'undefined' && !document.body.hasAttribute('data-focus-visible')) {\n        document.body.setAttribute('data-focus-visible', true);\n        onDOMReady(init);\n    }\n\n})));\n"],"names":["global","factory","exports","module","define","amd","this","init","hadKeyboardEvent","hadFocusVisibleRecently","hadFocusVisibleRecentlyTimeout","inputTypesWhitelist","text","search","url","tel","email","password","number","date","month","week","time","datetime","isValidFocusTarget","el","document","nodeName","classList","focusTriggersKeyboardModality","type","tagName","readOnly","isContentEditable","removePointerEventsClass","body","contains","remove","addPointerEventsClass","add","onKeyDown","e","activeElement","onPointerDown","onFocus","target","onBlur","window","clearTimeout","setTimeout","onVisibilityChange","visibilityState","addInitialPointerMoveListeners","addEventListener","onInitialPointerMove","removeInitialPointerMoveListeners","removeEventListener","toLowerCase","onDOMReady","callback","loaded","load","indexOf","readyState","hasAttribute","setAttribute"],"mappings":"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"}