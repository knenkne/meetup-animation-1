#!/usr/bin/env node

const program = require('commander')

const pckg = require('../package')

program
    .version(pckg.version)

    .usage('[options]')

    .option(
        '-m, --mode [mode]',
        'Mode server',
        /^(development|production)$/i,
        'development'
    )
    .option('-P, --port [port]', 'Server dev port', 4242)
    .option('--env [env]', 'Path environment')
    .option(
        '--with-open-browser',
        'Starting the server with opening the browser'
    )
    .option('--without-webpack', 'Starting the server without webpack build')

    .on('--help', () => {
        console.log(`
  Examples:
  $ @sbol/dev.server --mode development
        `)
    })
    .parse(process.argv)

if (program.env && typeof program.env === 'string') {
    program.env
        .split(/ +/)
        .map((item) => item.split('='))
        .forEach(([key, value = true]) => {
            process.env[key] = value
        })
}

process.env.NODE_ENV = program.mode
process.env.PORT = program.port

require('../src')(program)
