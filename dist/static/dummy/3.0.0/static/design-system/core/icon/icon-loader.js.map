{"version":3,"file":"icon-loader.js","sources":["../../src/icon/icon-loader.jsx"],"sourcesContent":["import React from 'react'\nimport PropTypes from 'prop-types'\nimport _ from 'lodash'\n\nimport { Icon } from './icon'\n\nconst SLASH = '/'\n\n/* eslint-disable valid-jsdoc, comment: некорректный парсинг jsdoc */\n/**\n * [Zeplin](https://app.zeplin.io/project/59312e1ebdf1da6fc8d37ffb/dashboard?q=elements%20icons)\n * Компонент для вывода svg-иконок\n *\n * @param {Object} props - свойства компонента\n * @return {JSX} - компонент\n */\nexport class IconLoader extends React.PureComponent {\n    static addIcons = (namespace, promise) => {\n        if (typeof promise === 'function') {\n            IconLoader.namespaces[namespace] = () => promise()\n                .then(({ default: defaultExport = {}, ...namedExport } = {}) => {\n                    const icons = { ...namedExport, ...defaultExport }\n\n                    IconLoader.namespaces[namespace] = _.mapKeys(icons, (value, key) => _.camelCase(key))\n\n                    return icons\n                })\n        } else {\n            IconLoader.namespaces[namespace] = _.mapKeys(promise, (value, key) => _.camelCase(key))\n        }\n    }\n\n    static propTypes = {\n        name: PropTypes.string.isRequired,\n        onError: PropTypes.func,\n        onClick: PropTypes.func\n    }\n\n    static defaultProps = {\n        size: void 0,\n        onError: _.noop,\n        onClick: _.noop\n    }\n\n\n    componentDidMount () {\n        this.loadIcons(this.props)\n    }\n\n    // eslint-disable-next-line babel/camelcase, comment: React UNSAFE method\n    UNSAFE_componentWillReceiveProps (nextProps) {\n        this.loadIcons(nextProps)\n    }\n\n    componentWillUnmount () {\n        this.unmount = true\n    }\n\n    getName = (fullPath) => _.camelCase(_.last(fullPath.split(SLASH)))\n    getNamespace = (fullPath) => _.dropRight(fullPath.split(SLASH)).join(SLASH)\n\n    static namespaces = {}\n\n    loadIcons = (props) => {\n        const namespace = this.getNamespace(props.name)\n        const { onError } = this.props\n\n        if (namespace && _.isFunction(IconLoader.namespaces[namespace])) {\n            IconLoader.namespaces[namespace]()\n                .then(() => {\n                    if (!this.unmount) {\n                        this.iconsLoaded = true\n                        this.forceUpdate()\n                    }\n                }).catch(onError)\n        } else {\n            onError()\n        }\n    }\n\n    render () {\n        const { name: fullPath, onError } = this.props\n\n        const namespace = this.getNamespace(fullPath)\n        const name = this.getName(fullPath)\n\n        if (!_.has(IconLoader.namespaces, [namespace, name])) {\n            if (this.iconsLoaded) {\n                onError()\n            }\n\n            return null\n        }\n        const icon = _.get(IconLoader.namespaces, [namespace, name])\n\n        return <Icon {...this.props} icon={icon} name={name} namespace={namespace} />\n    }\n}\n\nexport default IconLoader\n"],"names":["SLASH","IconLoader","fullPath","_","camelCase","last","split","dropRight","join","props","namespace","getNamespace","name","onError","isFunction","namespaces","then","unmount","iconsLoaded","forceUpdate","catch","loadIcons","nextProps","getName","has","icon","get","React","PureComponent","promise","default","defaultExport","namedExport","icons","mapKeys","value","key","PropTypes","string","isRequired","func","onClick","size","noop"],"mappings":"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"}