{"version":3,"file":"listbox.js","sources":["../../src/listbox/listbox.jsx"],"sourcesContent":["/* eslint-disable jsx-a11y/click-events-have-key-events, comment: a11 specific rule*/\n/* eslint-disable jsx-a11y/aria-activedescendant-has-tabindex, comment: a11 specific rule */\n/* eslint-disable complexity, comment: больошу обработчик клавиатурных событий */\nimport React, { Component } from 'react'\nimport PropTypes from 'prop-types'\nimport _ from 'lodash'\nimport cs from 'classnames'\n\nimport { memoizeFuncWithArgs } from '../utils'\nimport { autoScroll } from '../dropdown/utils'\nimport { Icon } from '../icon'\nimport { Perimeter } from '../perimeter'\n\nimport { SelectedOption } from './selected-option'\nimport { MultiSelectedOptions } from './multi-selected-options'\nimport { prevItem, nextItem, keyCodes } from './utils'\nimport defaultTheme from './style.css'\n\n/* eslint-disable valid-jsdoc, comment: некорректный парсинг jsdoc */\n/**\n * [Zeplin](https://app.zeplin.io/project/5c74ef0d753f3ebccdf8f33d/screen/5c8a5f62ed2b7b0dcbf560d1)\n * Простой и доступный (a11y) компонент для выпадающих списков.\n *\n // eslint-disable-next-line valid-jsdoc\n * @param {Object} props - свойства компонента\n * @return {JSX} - компонент\n */\nexport class Listbox extends Component {\n    static propTypes = {\n        value: PropTypes.oneOfType([PropTypes.string, PropTypes.arrayOf(PropTypes.string)]),\n        onChange: PropTypes.func,\n        onFocus: PropTypes.func,\n        onBlur: PropTypes.func,\n        options: PropTypes.arrayOf(PropTypes.shape({\n            value: PropTypes.string,\n            title: PropTypes.string,\n            icon: PropTypes.string,\n            additional: PropTypes.string,\n            description: PropTypes.string,\n            additionalDescription: PropTypes.string\n        })),\n        error: PropTypes.string,\n        id: PropTypes.string,\n        mode: PropTypes.oneOf(['select', 'autoselect', 'multiselect']),\n        /**\n         * если нужно прокинуть кастомную верстку\n         **/\n        as: PropTypes.func,\n        disabled: PropTypes.bool,\n        readonly: PropTypes.bool,\n        readOnly: PropTypes.bool,\n        theme: PropTypes.objectOf(PropTypes.string),\n        translations: PropTypes.shape({\n            itemNotChosenText: PropTypes.string\n        }),\n        'aria-labelledby': PropTypes.string,\n        'aria-label': PropTypes.string\n    }\n\n    static defaultProps = {\n        value: void 0,\n        onChange: _.noop,\n        onFocus: _.noop,\n        onBlur: _.noop,\n        options: [],\n        error: void 0,\n        id: void 0,\n        mode: void 0,\n        as: void 0,\n        disabled: false,\n        readonly: false,\n        readOnly: false,\n        theme: defaultTheme,\n        translations: {\n            // eslint-disable-next-line @sbol/common/no-cyrillic-outside-cms\n            itemNotChosenText: 'Выберите из списка'\n        },\n        'aria-labelledby': '',\n        'aria-label': ''\n    }\n\n    constructor (props) {\n        super(props)\n\n        this.state = {\n            open: false,\n            activeDescendant: this.getOptionValue()\n        }\n\n        this.id = this.props.id || _.uniqueId('ui-listbox')\n\n        if (this.isAutoSelect() && !this.props.value) {\n            this.props.onChange(this.getOptionValue())\n        }\n    }\n\n    setRefTarget = (component) => {\n        this.target = component\n    }\n\n    setRefContents = (component) => {\n        this.contents = component\n    }\n\n    setRefPerimeter = (component) => {\n        this.perimeter = component\n    }\n\n    getOptionValue = (index = 0) => this.props.options[index]?.value\n\n    getSelectedItem = () => {\n        if (this.isMultiSelect() && _.isArray(this.props.options)) {\n            const selectedOptions = this.props.options.filter((option) => _.includes(this.props.value, option.value))\n\n            if (!_.isEmpty(selectedOptions)) {\n                return (<MultiSelectedOptions items={selectedOptions} theme={this.props.theme} onChange={this.props.onChange} />)\n            }\n        }\n\n        const selectedOption = _.find(this.props.options, { value: this.props.value })\n\n        if (selectedOption) {\n            return this.props.as ? (\n                this.props.as(selectedOption)\n            ) : (\n                <SelectedOption {...selectedOption} theme={this.props.theme} />\n            )\n        }\n\n        return (\n            <span className={this.props.theme.itemNotChosen}>\n                {this.props.translations.itemNotChosenText}\n            </span>\n        )\n    }\n\n    handleTargetClick = () => {\n        if (this.state.open) {\n            this.handleClose()\n        } else {\n            this.handleOpen()\n        }\n    }\n\n    handleOpen = () => {\n        this.setState({\n            open: true\n        }, () => {\n            this.contents.focus()\n            this.perimeter.enableOnClickOutside()\n        })\n    }\n\n    handleClose = () => {\n        if (this.state.open) {\n            this.setState({\n                open: false\n            }, () => {\n                this.target.focus()\n                this.perimeter.disableOnClickOutside()\n            })\n        }\n    }\n\n    handleFocus = (event) => {\n        if (this.props.onFocus) {\n            this.props.onFocus(event)\n        }\n    }\n\n    handleBlur = () => {\n        if (this.props.onBlur) {\n            this.props.onBlur(this.props.value)\n        }\n    }\n\n    handleOptionFocus = (option) => {\n        this.setState({\n            activeDescendant: option.value\n        }, () => autoScroll(\n            document.getElementById(`${this.id}-option-${option.value}`),\n            document.getElementById(`${this.id}-contents`)\n        ))\n    }\n\n    handleOptionChoose = (option) => {\n        let newSelected\n\n        if (this.isMultiSelect()) {\n            newSelected = this.props.value || []\n\n            if (_.includes(this.props.value, option.value)) {\n                newSelected = _.reject(newSelected, (value) => value === option.value)\n            } else {\n                newSelected = newSelected.concat([option.value])\n            }\n        } else {\n            newSelected = option.value\n        }\n\n        this.setState({\n            activeDescendant: option.value\n        })\n\n        this.props.onChange(newSelected)\n    }\n\n    // нужно только в мультиселекте\n    handleOptionSetChoose = (options) => {\n        if (options.length === this.props.value.length) {\n            this.setState({\n                activeDescendant: this.props.options[0].value\n            })\n\n            this.props.onChange([])\n        } else {\n            this.setState({\n                activeDescendant: _.last(options).value\n            })\n\n            const mappedOptions = _.map(options, (option) => option.value)\n            const nextOptions = _.uniq(_.isEmpty(this.props.value) ? mappedOptions : mappedOptions.concat(this.props.value))\n\n            this.props.onChange(nextOptions)\n        }\n    }\n\n    handleKeyDownContents = (event) => {\n        switch (event.keyCode) {\n            case keyCodes.KEY_TAB: {\n                this.handleClose()\n                break\n            }\n            case keyCodes.KEY_ENTER:\n            case keyCodes.KEY_SPACE: {\n                event.preventDefault()\n                this.handleOptionChoose(_.find(this.props.options, { value: this.state.activeDescendant }))\n\n                if (!this.isMultiSelect()) {\n                    this.handleClose()\n                }\n                break\n            }\n\n            case keyCodes.KEY_ESCAPE: {\n                event.preventDefault()\n                this.handleClose()\n                break\n            }\n\n            case keyCodes.KEY_ARROW_DOWN: {\n                event.preventDefault()\n                const nextOption = nextItem(this.props.options, this.state.activeDescendant)\n\n                if (nextOption) {\n                    if (this.isMultiSelect() && event.shiftKey) {\n                        this.handleOptionChoose(nextOption)\n                    }\n\n                    this.handleSelectKey(nextOption)\n                }\n                break\n            }\n\n            case keyCodes.KEY_ARROW_UP: {\n                event.preventDefault()\n                const nextOption = prevItem(this.props.options, this.state.activeDescendant)\n\n                if (nextOption) {\n                    if (this.isMultiSelect() && event.shiftKey) {\n                        this.handleOptionChoose(nextOption)\n                    }\n\n                    this.handleSelectKey(nextOption)\n                }\n                break\n            }\n\n            case keyCodes.KEY_HOME: {\n                event.preventDefault()\n\n                if (this.isMultiSelect() && event.shiftKey && event.ctrlKey) {\n                    const currentIndex = _.findIndex(this.props.options, { value: this.state.activeDescendant })\n                    this.handleOptionSetChoose(this.props.options.slice(0, currentIndex + 1))\n                }\n\n                const nextOption = _.first(this.props.options)\n                this.handleSelectKey(nextOption)\n                break\n            }\n\n            case keyCodes.KEY_END: {\n                event.preventDefault()\n\n                if (this.isMultiSelect() && event.shiftKey && event.ctrlKey) {\n                    const currentIndex = _.findIndex(this.props.options, { value: this.state.activeDescendant })\n                    this.handleOptionSetChoose(this.props.options.slice(currentIndex))\n                }\n\n                const nextOption = _.last(this.props.options)\n                this.handleSelectKey(nextOption)\n                break\n            }\n\n            case keyCodes.KEY_A: {\n                if (this.isMultiSelect() && event.ctrlKey) {\n                    event.preventDefault()\n                    this.handleOptionSetChoose(this.props.options)\n                }\n                break\n            }\n\n            default: {\n                break\n            }\n        }\n    }\n\n\n    // переиспользуемый кусок handleKeyDownContents для listbox\n    handleSelectKey = (option) => {\n        this.handleOptionFocus(option)\n        if (this.isAutoSelect()) {\n            this.handleOptionChoose(option)\n        }\n    }\n\n    // дополнительный идентификатор выбора для listbox\n    isSelected = (option) => {\n        if (this.isMultiSelect()) {\n            return _.includes(this.props.value, option.value)\n        }\n\n        return this.props.value === option.value\n    }\n\n    isActiveDescendant = (option) => this.state.activeDescendant === option.value\n    isMultiSelect = () => this.props.mode === 'multiselect'\n    isAutoSelect = () => this.props.mode === 'autoselect'\n\n    render () {\n        return (\n            <Perimeter\n                onClickOutside={this.handleClose}\n                disableOnClickOutside\n                ref={this.setRefPerimeter}\n            >\n                <div\n                    id={`${this.id}-wrapper`}\n                    className={this.props.theme.dropdown}\n                >\n                    {this.renderTarget()}\n                    {this.renderContents()}\n                </div>\n            </Perimeter>\n        )\n    }\n\n    renderTarget = () => (\n        <button\n            type=\"button\"\n            className={\n                cs(\n                    this.props.theme.target,\n                    this.state.open && this.props.theme.targetOpened,\n                    this.props.error && this.props.theme.error,\n                    (this.props.disabled || !this.props.options?.length) && this.props.theme.disabled,\n                    (this.props.readOnly || this.props.readonly) && this.props.theme.readonly\n                )\n            }\n            id={this.id}\n            ref={this.setRefTarget}\n            onClick={this.handleTargetClick}\n            onFocus={this.handleFocus}\n            onBlur={this.handleBlur}\n            aria-haspopup=\"listbox\"\n            aria-expanded={this.state.open ? true : void 0}\n            // listbox должен связать себя с назначением\n            aria-labelledby={cs(this.props['aria-labelledby'], this.id)}\n            aria-label={this.props['aria-label']}\n            disabled={this.props.disabled || this.props.readOnly || this.props.readonly || !this.props.options?.length}\n        >\n            <div className={cs(this.props.theme.item, this.props.theme.first)}>\n                {this.getSelectedItem()}\n            </div>\n            <div className={cs(this.props.theme.arrow, this.state.open && this.props.theme.arrowOpened)}>\n                <Icon name=\"icon:core/common/down-arrow\" />\n            </div>\n        </button>\n    )\n\n    renderContents = () => (\n        <div\n            className={cs(\n                this.props.theme.contents,\n                this.state.open && this.props.theme.opened\n            )}\n        >\n            <ul\n                id={`${this.id}-contents`}\n                className={this.props.theme.contentsView}\n                ref={this.setRefContents}\n                onKeyDown={this.handleKeyDownContents}\n                tabIndex={-1}\n                role=\"listbox\"\n                aria-activedescendant={this.state.open ? `${this.id}-option-${this.state.activeDescendant}` : void 0}\n                // фишка мультиселекта в листбоксе\n                aria-multiselectable={this.isMultiSelect()}\n                // listbox должен связать себя с назначением\n                aria-labelledby={this.props['aria-labelledby']}\n                aria-label={this.props['aria-label']}\n            >\n                {this.props.options.map(this.renderOption)}\n            </ul>\n        </div>\n    )\n\n    renderOption = (option) => {\n        const activeDescendant = this.isActiveDescendant(option)\n        const selected = this.isSelected(option)\n\n        return (\n            <li\n                key={option.value}\n                id={`${this.id}-option-${option.value}`}\n                className={cs(\n                    this.props.theme.item,\n                    activeDescendant && this.props.theme.focused,\n                    selected && this.props.theme.checked\n                )}\n                onClick={memoizeFuncWithArgs(this.handleOptionChoose, option)}\n                onMouseUp={this.isMultiSelect() ? void 0 : this.handleClose}\n                role=\"option\"\n                aria-selected={selected}\n            >\n                {this.props.as ? (\n                    this.props.as(option)\n                ) : (\n                    <SelectedOption {...option} theme={this.props.theme} />\n                )}\n            </li>\n        )\n    }\n}\n\nListbox.theme = defaultTheme\n\nexport default Listbox\n"],"names":["Listbox","props","component","target","contents","perimeter","index","options","value","isMultiSelect","_","isArray","selectedOptions","filter","option","includes","isEmpty","theme","onChange","selectedOption","find","as","itemNotChosen","translations","itemNotChosenText","state","open","handleClose","handleOpen","setState","focus","enableOnClickOutside","disableOnClickOutside","event","onFocus","onBlur","activeDescendant","autoScroll","document","getElementById","id","newSelected","reject","concat","length","last","mappedOptions","map","nextOptions","uniq","keyCode","keyCodes","KEY_TAB","KEY_ENTER","KEY_SPACE","preventDefault","handleOptionChoose","KEY_ESCAPE","KEY_ARROW_DOWN","nextOption","nextItem","shiftKey","handleSelectKey","KEY_ARROW_UP","prevItem","KEY_HOME","ctrlKey","currentIndex","findIndex","handleOptionSetChoose","slice","first","KEY_END","KEY_A","handleOptionFocus","isAutoSelect","mode","cs","targetOpened","error","disabled","readOnly","readonly","setRefTarget","handleTargetClick","handleFocus","handleBlur","item","getSelectedItem","arrow","arrowOpened","opened","contentsView","setRefContents","handleKeyDownContents","renderOption","isActiveDescendant","selected","isSelected","focused","checked","memoizeFuncWithArgs","getOptionValue","uniqueId","setRefPerimeter","dropdown","renderTarget","renderContents","Component","PropTypes","oneOfType","string","arrayOf","func","shape","title","icon","additional","description","additionalDescription","oneOf","bool","objectOf","noop","defaultTheme"],"mappings":"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"}