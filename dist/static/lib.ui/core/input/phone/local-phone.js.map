{"version":3,"file":"local-phone.js","sources":["../../../src/input/phone/local-phone.jsx"],"sourcesContent":["import React from 'react'\nimport PropTypes from 'prop-types'\nimport _ from 'lodash'\nimport { conformToMask } from 'text-mask-core/dist/textMaskCore'\n\nimport { Masked } from '../masked/masked'\nimport { Input } from '../input'\nimport { getInputDiff } from '../utils'\nimport { typeaheadFactory } from '../hoc/typeahead'\n\nimport { phoneMask, trimPhoneRight, unmaskedPhone } from './phone-mask'\n\nconst EMPTY_STRING = ''\nconst PLUS = '+'\nconst COUNTRY_CODE = '7'\nconst COUNTRY_CODE_PREFIX = `${PLUS}${COUNTRY_CODE} (`\nconst PLACEHOLDER = `${COUNTRY_CODE_PREFIX}___) ___-__-__`\nconst START_OF_DELETING = COUNTRY_CODE_PREFIX.length\n\nconst createMaskedTypeahead = typeaheadFactory(\n    (props) => _.extend({}, props, { guide: false }),\n    (props) => _.extend({}, props, { guide: true })\n)\n\nconst MaskedTypeahead = createMaskedTypeahead(Masked)\n\nconst getConformedValue = (value, arrayMask) => {\n    const maskedValue = _.get(conformToMask(COUNTRY_CODE_PREFIX + value, arrayMask), 'conformedValue', EMPTY_STRING)\n    return trimPhoneRight(maskedValue)\n}\n\n/* eslint-disable valid-jsdoc, comment: некорректный парсинг jsdoc */\n/**\n * [Zeplin](https://app.zeplin.io/project/59312e1ebdf1da6fc8d37ffb/dashboard?q=phone)\n * Поле ввода российского номера телефона\n * Справочник для автономной работы предоставляется сайтом [На Связи](https://na-svyazi.ru/russia_code.htm)\n *\n * @param {Object} props - свойства компонента\n * @return {JSX} - компонент\n */\nexport class LocalPhone extends React.Component {\n    static normalize = (event) => {\n        const { target } = event\n        const { selectionStart } = target\n        let normalizedValue = target.value\n        const firstChar = normalizedValue.charAt(0)\n        if (firstChar === COUNTRY_CODE && selectionStart === 0) {\n            normalizedValue = normalizedValue.substring(START_OF_DELETING)\n        } else if (firstChar !== PLUS && normalizedValue.length > 1) {\n            if (normalizedValue.charAt(1) === PLUS && selectionStart === 1) {\n                normalizedValue = normalizedValue.substring(1) + firstChar\n            } else {\n                normalizedValue = COUNTRY_CODE_PREFIX + normalizedValue\n            }\n        }\n        if (target.value !== normalizedValue) {\n            target.value = normalizedValue\n            target.setSelectionRange(selectionStart, selectionStart)\n        }\n    }\n\n    static displayName = 'Input.LocalPhone'\n\n    static getFormattedValue = (value = '') => conformToMask(value, Masked.utils.maskedFormat(phoneMask(value), value))?.conformedValue\n\n    constructor (props) {\n        super(props)\n        this.state = {\n            suggest: props.suggest\n        }\n        this.cache = EMPTY_STRING\n        if (_.isEmpty(props.suggest)) {\n            import('./phone-codes.json')\n                .then(({ default: suggest }) => {\n                    if (!this.unmount) {\n                        this.setState({ suggest })\n                    }\n                })\n        }\n    }\n\n    componentWillUnmount () {\n        this.unmount = true\n    }\n\n    handleKeyDown = (event) => {\n        const { selectionStart, selectionEnd } = event.target\n        this.prevSelectionStart = selectionStart < START_OF_DELETING &&\n        selectionStart === selectionEnd ?\n            event.target.setSelectionRange(START_OF_DELETING, START_OF_DELETING)\n            : selectionStart\n        this.props.onKeyDown(event)\n    }\n\n    handleMouseUp = (event) => {\n        const { selectionStart, selectionEnd } = event.target\n        this.prevSelectionStart = selectionStart < START_OF_DELETING &&\n        selectionStart === selectionEnd ?\n            event.target.setSelectionRange(START_OF_DELETING, START_OF_DELETING)\n            : selectionStart\n        this.props.onMouseUp(event)\n    }\n\n    handleContextMenu = (event) => {\n        this.prevSelectionStart = event.target.selectionStart\n        this.props.onContextMenu(event)\n    }\n\n    handleOnChange = (e) => {\n        if (Masked.utils.isMaskedValue(this.props.value)) {\n            this.cache = EMPTY_STRING\n            this.props.onChange(getInputDiff(e.target.value, this.prevSelectionStart, e.target.selectionStart), e)\n        } else {\n            this.cache = e.target.value\n            this.props.onChange(unmaskedPhone(e.target.value), e)\n        }\n    }\n\n    handleOnBlur = (e) => {\n        const { initialValue, onBlur } = this.props\n        const fieldValue = e.target.value\n        if (unmaskedPhone(initialValue) !== unmaskedPhone(fieldValue)) {\n            onBlur(unmaskedPhone(fieldValue), e)\n        }\n    }\n\n    makePhoneMask = (value) => Masked.utils.maskedFormat(phoneMask(value, this.state.suggest), value)\n\n    render () {\n        const { value, theme, ...props } = this.props\n        const rawValue = unmaskedPhone(value)\n        const calculatedMask = this.makePhoneMask(rawValue)\n\n        const maskedValue = rawValue ? getConformedValue(value, calculatedMask) : COUNTRY_CODE_PREFIX\n        const newValue = maskedValue === trimPhoneRight(this.cache) ? this.cache : maskedValue\n\n        const passedProps = _(props)\n            .omit('suggest')\n            .extend({\n                placeholder: PLACEHOLDER,\n                theme,\n                value: newValue,\n                mask: this.makePhoneMask,\n                onChange: this.handleOnChange,\n                onBlur: this.handleOnBlur,\n                onKeyDown: this.handleKeyDown,\n                onMouseUp: this.handleMouseUp,\n                onContextMenu: this.handleContextMenu,\n                placeholderChar: '_',\n                type: 'tel'\n            })\n            .value()\n\n        return (\n            <MaskedTypeahead {...passedProps} />\n        )\n    }\n}\n\nLocalPhone.propTypes = {\n    value: PropTypes.string,\n    onChange: PropTypes.func,\n    onFocus: PropTypes.func,\n    onBlur: PropTypes.func,\n    suggest: PropTypes.array,\n    onKeyDown: PropTypes.func,\n    onMouseUp: PropTypes.func,\n    onContextMenu: PropTypes.func,\n    initialValue: PropTypes.string,\n    theme: PropTypes.shape({\n        input: PropTypes.string,\n        phoneBlock: PropTypes.string,\n        block: PropTypes.string,\n        disabled: PropTypes.string,\n        error: PropTypes.string,\n        icon: PropTypes.string,\n        inputIcon: PropTypes.string\n    })\n}\n\nLocalPhone.defaultProps = {\n    value: '',\n    onChange: _.noop,\n    onFocus: _.noop,\n    onBlur: _.noop,\n    onKeyDown: _.noop,\n    onMouseUp: _.noop,\n    onContextMenu: _.noop,\n    suggest: [],\n    initialValue: '',\n    theme: Input.theme\n}\n"],"names":["EMPTY_STRING","PLUS","COUNTRY_CODE","COUNTRY_CODE_PREFIX","PLACEHOLDER","START_OF_DELETING","length","createMaskedTypeahead","typeaheadFactory","props","_","extend","guide","MaskedTypeahead","Masked","getConformedValue","value","arrayMask","maskedValue","get","conformToMask","trimPhoneRight","LocalPhone","event","target","selectionStart","selectionEnd","prevSelectionStart","setSelectionRange","onKeyDown","onMouseUp","onContextMenu","e","utils","isMaskedValue","cache","onChange","getInputDiff","unmaskedPhone","initialValue","onBlur","fieldValue","maskedFormat","phoneMask","state","suggest","isEmpty","then","default","unmount","setState","theme","rawValue","calculatedMask","makePhoneMask","newValue","passedProps","omit","placeholder","mask","handleOnChange","handleOnBlur","handleKeyDown","handleMouseUp","handleContextMenu","placeholderChar","type","React","Component","normalizedValue","firstChar","charAt","substring","conformedValue","propTypes","PropTypes","string","func","onFocus","array","shape","input","phoneBlock","block","disabled","error","icon","inputIcon","defaultProps","noop","Input"],"mappings":"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"}